!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}n.r(e);var i=function(){function t(){var e,n,o,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=void 0,(n="values")in(e=this)?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,this.values=new Float32Array([i,r])}var e,n,i;return e=t,i=[{key:"create",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)}}],(n=[{key:"toString",value:function(){return"[".concat(this.values[0],",").concat(this.values[1],"]")}},{key:"x",get:function(){return this.values[0]},set:function(t){this.values[0]=t}},{key:"y",get:function(){return this.values[1]},set:function(t){this.values[0]=t}}])&&o(e.prototype,n),i&&o(e,i),t}();function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a,s=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"id",-1),r(this,"enabled",!1),r(this,"callback",void 0),r(this,"callbackData",void 0),r(this,"countdown",0),r(this,"timeout",0),r(this,"onlyOnce",!1),this.callback=e};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){return!e||"object"!==u(e)&&"function"!=typeof e?f(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.MOUSEEVENT=0]="MOUSEEVENT",t[t.MOUSEDOWN=1]="MOUSEDOWN",t[t.MOUSEUP=2]="MOUSEUP",t[t.MOUSEMOVE=3]="MOUSEMOVE",t[t.MOUSEDRAG=4]="MOUSEDRAG",t[t.KEYBOARDEVENT=5]="KEYBOARDEVENT",t[t.KEYUP=6]="KEYUP",t[t.KEYDOWN=7]="KEYDOWN",t[t.KEYPRESS=8]="KEYPRESS"}(a||(a={}));var y=function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.MOUSEEVENT;d(this,t),v(this,"altKey",void 0),v(this,"ctrlKey",void 0),v(this,"shiftKey",void 0),v(this,"type",void 0),this.altKey=e,this.ctrlKey=n,this.shiftKey=o,this.type=i},b=function(t){function e(t,n){var o,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return d(this,e),v(f(o=c(this,l(e).call(this,r,a,s))),"button",void 0),v(f(o),"canvasPosition",void 0),v(f(o),"localPosition",void 0),o.canvasPosition=t,o.button=n,o.localPosition=i.create(),o}return h(e,y),e}(),m=function(t){function e(t,n,o){var i,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return d(this,e),v(f(i=c(this,l(e).call(this,r,s,u,a.KEYBOARDEVENT))),"key",void 0),v(f(i),"keyCode",void 0),v(f(i),"repeat",void 0),i.key=t,i.keyCode=n,i.repeat=o,i}return h(e,y),e}();function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){return!e||"object"!==_(e)&&"function"!=typeof e?E(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function T(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(){function t(e){S(this,t),T(this,"_start",!1),T(this,"_appId",-1),T(this,"_lastTime",void 0),T(this,"_startTime",void 0),T(this,"_fps",0),T(this,"canvas",void 0),T(this,"isSupportMouseMove",void 0),T(this,"_isMouseDown",void 0),T(this,"timers",[]),T(this,"_timerId",-1),this.canvas=e,this.canvas.addEventListener("mousedown",this,!1),this.canvas.addEventListener("mouseup",this,!1),this.canvas.addEventListener("mousemove",this,!1),window.addEventListener("keydown",this,!1),window.addEventListener("keyup",this,!1),window.addEventListener("keypress",this,!1),this.isSupportMouseMove=!1,this._isMouseDown=!1}var e,n,o;return e=t,(n=[{key:"start",value:function(){this._start||(this._start=!0,this._appId=-1,this._lastTime=-1,this._startTime=-1,this._appId=requestAnimationFrame(this.step.bind(this)))}},{key:"stop",value:function(){this._start&&(cancelAnimationFrame(this._appId),this._appId=-1,this._lastTime=-1,this._startTime=-1,this._start=!1)}},{key:"isRunning",value:function(){return this._start}},{key:"step",value:function(t){var e=this;-1===this._startTime&&(this._startTime=t),-1===this._lastTime&&(this._lastTime=t);var n=t-this._startTime,o=t-this._lastTime;0!==o&&(this._fps=1e3/o),o/=1e3,this._lastTime=t,this._handleTimers(o),this.update(n,o),this.render(),this._appId=requestAnimationFrame(function(t){e.step(t)})}},{key:"handleEvent",value:function(t){switch(t.type){case"mousedown":this._isMouseDown=!0,this.dispatchMouseDown(this._toCanvasMouseEvent(t));break;case"mouseup":this._isMouseDown=!1,this.dispatchMouseUp(this._toCanvasMouseEvent(t));break;case"mousemove":this.isSupportMouseMove&&this.dispatchMouseMove(this._toCanvasMouseEvent(t)),this._isMouseDown&&this.dispatchMouseDrag(this._toCanvasMouseEvent(t));break;case"keypress":this.dispatchKeyPress(this._toCanvasKeyBoardEvent(t));break;case"keydown":this.dispatchKeyDown(this._toCanvasKeyBoardEvent(t));break;case"keyUp":this.dispatchKeyUp(this._toCanvasKeyBoardEvent(t))}}},{key:"dispatchMouseDown",value:function(t){}},{key:"dispatchMouseUp",value:function(t){}},{key:"dispatchMouseMove",value:function(t){}},{key:"dispatchMouseDrag",value:function(t){}},{key:"dispatchKeyPress",value:function(t){}},{key:"dispatchKeyDown",value:function(t){}},{key:"dispatchKeyUp",value:function(t){}},{key:"_viewportToCanvasCoordinate",value:function(t){if(!this.canvas)throw new Error("canvas is null.");var e=this.canvas.getBoundingClientRect();if("mousedown"===t.type&&console.log("boundingClientRect: ".concat(JSON.stringify(e),",clientX: ").concat(t.clientX,", clientY: ").concat(t.clientY)),t.target){var n=0,o=0,r=0,a=0,s=window.getComputedStyle(t.target),u=s.borderLeftWidth;null!==u&&(n=parseInt(u,10)),null!==(u=s.borderTopWidth)&&(o=parseInt(u,10)),null!==(u=s.paddingLeft)&&(r=parseInt(u,10)),null!==(u=s.paddingTop)&&(a=parseInt(u,10));var c=t.clientX-e.left-n-r,l=t.clientY-e.top-o-a;return i.create(c,l)}}},{key:"_toCanvasMouseEvent",value:function(t){var e=t,n=this._viewportToCanvasCoordinate(e);return new b(n,e.button,e.altKey,e.ctrlKey,e.shiftKey)}},{key:"_toCanvasKeyBoardEvent",value:function(t){var e=t;return new m(e.key,e.keyCode,e.repeat,e.altKey,e.ctrlKey,e.shiftKey)}},{key:"update",value:function(t,e){}},{key:"render",value:function(){}},{key:"_handleTimers",value:function(t){if(!(this.timers.length<=0))for(var e=0;e<this.timers.length;e++){var n=this.timers[e];!1!==n.enabled&&(n.countdown-=t,n.countdown<=0&&(n.callback(n.id,n.callbackData),!1===n.onlyOnce?n.countdown=n.timeout:n.enabled=!1))}}},{key:"addTimer",value:function(t){for(var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=0;r<this.timers.length;r++){var a=this.timers[r];if(!1===a.enabled)return a.callback=t,a.callbackData=i,a.timeout=n,a.countdown=n,a.enabled=!0,a.onlyOnce=o,a.id}return(e=new s(t)).callbackData=i,e.timeout=n,e.countdown=n,e.enabled=!0,e.onlyOnce=o,e.id=++this._timerId,this.timers.push(e),e.id}},{key:"removeTimer",value:function(t){for(var e=!1,n=0;n<this.timers.length;n++)if(this.timers[n].id===t){this.timers[n].enabled=!1,e=!0;break}return e}},{key:"fps",get:function(){return this._fps}}])&&M(e.prototype,n),o&&M(e,o),t}(),j=function(t){function e(t,n){var o;return S(this,e),T(E(o=w(this,g(e).call(this,t))),"context2D",void 0),o.context2D=o.canvas.getContext("2d",n),o}return O(e,P),e}();function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function D(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function C(t,e){return!e||"object"!==K(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var I,R,B,Y,A=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),C(this,x(e).call(this,t))}var n,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}(e,j),n=e,(o=[{key:"render",value:function(){this.drawText(""+this._appId)}},{key:"drawText",value:function(t){if(null!==this.context2D){var e=this.context2D;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save(),e.textBaseline="middle",e.textAlign="center";var n=.5*e.canvas.width,o=.5*e.canvas.height;e.font="normal 100px Arial",e.fillStyle="pink",e.strokeStyle="yellow",e.fillText(t,n,o),e.strokeText(t,n,o),e.restore()}}},{key:"dispatchMouseDown",value:function(t){console.log("鼠标按下",t)}},{key:"dispatchKeyPress",value:function(t){console.log("按键",t)}}])&&D(n.prototype,o),i&&D(n,i),e}();R=document.getElementById("canvas"),B=document.getElementById("btnStart"),Y=document.getElementById("btnStop"),null!==R&&(I=new A(R)).addTimer(function(t,e){console.log(e)},3,!1,{a:1}),B.onclick=function(){null!==I&&I.start()},Y.onclick=function(){null!==I&&(I.stop(),I.removeTimer(0))}}]);